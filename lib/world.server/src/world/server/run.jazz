;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; World Server Run
;;;


(module world.server.run jazz


(import (jazz.debuggee)
        (jazz.graphic.opengl.platform)
        (jazz.jrm)
        (jazz.system)
        (world)
        (world.io)
        (world.server)
        (world.window))


(register-product-run 'world.server
  (lambda (descriptor)
    (parameterize ((run-loop? #f))
      (boot-environment~ (new World-Server)))
    (let ((process (get-process))
          (visible? (boolean-parameter "window" 'world.server.window? #f)))
      (set-world-window (new-opengl-window class: World-Window position: {Point 50 50} size: {Dimension 1200 800} visible?: visible?))
      (select-default-world)
      (set-default-context world)
      (start-panel~ process)
      (run-loop~ process)))))
