;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; World Client
;;;


(module world.client.window jazz


(import (jazz.graphic)
        (jazz.graphic.opengl.glew)
        (jazz.io)
        (world.geometry)
        (world.object)
        (world.texture)
        (world.window))


;;;
;;;; Window
;;;


(define *world-window*
  #f)


(definition public (get-world-window)
  *world-window*)


(definition public (setup-world-window window)
  (set! *world-window* window)
  (set-?l window))


(definition public (current-world)
  (let ((window (get-world-window)))
    (and window (get-world~ window))))


(define *bubbles-world* #f)
(define *snakes-world*  #f)
(define *tree-world*    #f)
(define *live-world*    #f)


(definition public (get-bubbles-world)
  (new-bubbles-world #f))


(definition public (get-snakes-world)
  (new-snakes-world #f))


(definition public (get-tree-world)
  (new-tree-world #f))


(definition public (get-live-world)
  (new-live-world #f))


(definition (new-bubbles-world reset?)
  (if (and *bubbles-world* (not reset?))
      *bubbles-world*
    (let ((world (new (module-ref 'world.client.bubbles 'Bubbles-World))))
      (set-window~ world *world-window*)
      (setup-opengl~ world)
      (initialize-world~ world)
      (set! *bubbles-world* world)
      (set-?w world)
      world)))


(definition public (select-bubbles (reset? #f))
  (set-world~ *world-window* (new-bubbles-world reset?)))


(definition (new-snakes-world reset?)
  (if (and *snakes-world* (not reset?))
      *snakes-world*
    (let ((world (new (module-ref 'world.client.snakes 'Snakes-World))))
      (set-window~ world *world-window*)
      (setup-opengl~ world)
      (initialize-world~ world)
      (set! *snakes-world* world)
      (set-?w world)
      world)))


(definition public (select-snakes (reset? #f))
  (set-world~ *world-window* (new-snakes-world reset?)))


(definition (new-tree-world reset?)
  (if (and *tree-world* (not reset?))
      *tree-world*
    (let ((world (new (module-ref 'world.client.tree 'Tree-World))))
      (set-window~ world *world-window*)
      (setup-opengl~ world)
      (initialize-world~ world)
      (set! *tree-world* world)
      (set-?w world)
      world)))


(definition public (select-tree (reset? #f))
  (set-world~ *world-window* (new-tree-world reset?)))


(definition (new-live-world reset?)
  (if (and *live-world* (not reset?))
      *live-world*
    (let ((world (new (module-ref 'world.live 'Live-World))))
      (set-window~ world *world-window*)
      (setup-opengl~ world)
      (initialize-world~ world)
      (set! *live-world* world)
      (set-?w world)
      (set-? world)
      world)))


(definition public (select-live (reset? #f))
  (set-world~ *world-window* (new-live-world reset?)))


;;;
;;;; Material
;;;


;float mcolor[] = { 1.0f, 0.0f, 0.0f, 1.0f };
;glMaterialfv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, mcolor);
;// now, draw polygon as its material properties will be affected by the glMaterialfv call.
)
