;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; Tree
;;;


(module world.client.tree jazz


(import (jazz.geometry)
        (jazz.graphic)
        (jazz.graphic.opengl)
        (jazz.graphic.opengl.platform)
        (jazz.io)
        (jazz.library)
        (jazz.literals)
        (jazz.media)
        (jazz.network)
        (jazz.platform)
        (jazz.platform.cairo)
        (jazz.runtime)
        (jazz.system)
        (jazz.ui)
        (jazz.ui.window)
        (time)
        (world.autoload)
        (world.client)
        (world.geometry)
        (world.object)
        (world.texture)
        (world.window))


;;;
;;;; World
;;;


(class Tree-World extends World
  
  
  ;;;
  ;;;; Initialize
  ;;;
  
  
  (method override (initialize-opengl)
    (define (setup-eye)
      (set! eye (new Vertex 0.0 16.0 40.0))
      (set! eye-sight (new Vertex 0.0 0.0 -1.0))
      (set! eye-up (new Vertex 0.0 1.0 0.0))
      (set! eye-right (new Vertex 1.0 0.0 0.0)))
    
    (nextmethod)
    (setup-eye))
  
  
  ;;;
  ;;;; Draw
  ;;;
  
  
  (method override (draw-interface)
    (nextmethod)
    (gl-frame-rect {Rect 100 100 200 200} {Color Red})
    (gl-pixel {Point 100 250} {Color Green})
    (gl-line {Point 110 250} {Point 190 250} {Color Orange})
    (gl-pixel {Point 200 250} {Color Green})
    (gl-frame-circle {Point 150 350} 50 {Color Yellow})
    (gl-segment-circle {Point 150 500} 50 {Color Light-Blue} 100))
  
  
  ;;;
  ;;;; Events
  ;;;
  
  
  (method override (process-keys)
    (let ((evt (make-event Keyboard-Event :char self)))
      (process-movement evt)))
  
  
  (method override (process-shortcut shortcut)
    (continuation-capture
      (lambda (return)
        (cond ;; select
              ((shortcut=? shortcut {Shortcut :alt #\1}) (select-bubbles))
              ((shortcut=? shortcut {Shortcut :alt #\2}) (select-snakes))
              ((shortcut=? shortcut {Shortcut :alt #\3}) (select-tree))
              ((shortcut=? shortcut {Shortcut :alt #\4}) (select-live))
              (else (continuation-return return #f)))
        #t)))))
