;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Remote Client Implementation
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2016
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.client.remote.implementation jazz


(import (world)
        (world.autoload)
        (world.support)
        (world.syntax (phase syntax))
        (world.task))


(class World-Remote-Client extends Object
  
  
  (method public (server-entered client-id client-no character-name character-avatar player-id player-position player-lookat)
    ;; mega quick hack in case server sends updates before we are ready
    ;; this should be a clean readyness notification from client to server
    (when (current-tier+)
      (with-task-mutex
        (lambda ()
          (server-entered~ (client-tier) client-id client-no character-name character-avatar player-id player-position player-lookat)))))
  
  
  (method public (server-exited character-name)
    ;; mega quick hack in case server sends updates before we are ready
    ;; this should be a clean readyness notification from client to server
    (when (current-tier+)
      (with-task-mutex
        (lambda ()
          (server-exited~ (client-tier) character-name)))))
  
  
  (method public (server-update changes)
    ;; mega quick hack in case server sends updates before we are ready
    ;; this should be a clean readyness notification from client to server
    (when (current-tier+)
      (unless being-debugged?
        (with-task-mutex
          (lambda ()
            (server-update~ (client-tier) changes))))))
  
  
  (method public (server-message sender kind message)
    ;; mega quick hack in case server sends updates before we are ready
    ;; this should be a clean readyness notification from client to server
    (when (current-tier+)
      (unless being-debugged?
        (with-task-mutex
          (lambda ()
            (server-message~ (client-tier) sender kind message))))))
  
  
  (method public (position-client rect)
    ;; mega quick hack in case server sends updates before we are ready
    ;; this should be a clean readyness notification from client to server
    (when (current-tier+)
      (unless being-debugged?
        (with-task-mutex
          (lambda ()
            (position-client~ (client-tier) rect))))))
  
  
  (method public (restore-client)
    ;; mega quick hack in case server sends updates before we are ready
    ;; this should be a clean readyness notification from client to server
    (when (current-tier+)
      (unless being-debugged?
        (with-task-mutex
          (lambda ()
            (restore-client~ (client-tier)))))))))
