;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Light Syntax
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2015
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.light-syntax jazz


;; TODO
;; - maybe make the 1 - 4 range map to for example .4 - 1.
;;   instead of .25 - 1. to get less intense ambient occlusion
;; - also need to fix dwarf dome's completely black spots
;; - understand why a night torch gives a losange pattern in
;;   yownu and more like a plus in minecraft. is it all due to
;;   minecraft's usage of a texture to map block/sky to light?
;; - adjust and/or improve fog


;;;
;;;; Ambient
;;;


(definition protected (adjust-lighting lighting <f32vector> n <fx> shade <fl>)
  (f32vector-set! lighting n (* shade (f32vector-ref lighting n))))


;;;
;;;; Baked
;;;


(definition protected (baked-light minecraft?)
  (if (not minecraft?)
#/C/
    vec4 baked_light = vec4(lighting, 1.0);
//#
    
#/C/
    float blocklight = lighting.x;
    float skylight = lighting.y;
    float ambience = lighting.z;
    float lighttime = daylight_whatthefuck * 11. + 4.;
    float dimmer = lighttime / 15.;
    skylight = skylight * dimmer;
    float light = max(blocklight, skylight);
    if (player_glow >= 0.)
    {
        float z = distance(player_coord, vertex_coord);
        light = light + ambience * min(60, player_glow / z);
    }
    light = light / 60.;
    // light = pow(.8, (60. - light) / 5.);
    vec4 baked_light = vec4(light, light, light, 1.0);
//#)))
