;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; Actors
;;;


(module world.actor jazz


(import (jazz.geometry)
        (jazz.graphic)
        (jazz.graphic.opengl)
        (jazz.graphic.opengl.platform)
        (jazz.io)
        (jazz.library)
        (jazz.literals)
        (jazz.media)
        (jazz.network)
        (jazz.platform)
        (jazz.platform.cairo)
        (jazz.runtime)
        (jazz.system)
        (jazz.ui)
        (jazz.ui.dialog)
        (jazz.ui.window)
        (time)
        (world.autoload)
        (world.client)
        (world.foreign)
        (world.geometry)
        (world.object)
        (world.sprite)
        (world.texture)
        (world.window))


;;;
;;;; Actor
;;;


(class Actor extends Sprite
  
  
  (slot lookat <LookAt> initialize (make-lookat) accessors generate)
  
  
  (method public virtual (stomp)
    #f)
  
  
  (method override (draw-3d)
    (glPushMatrix)
    (glTranslatef x y z)
    (when lookat
      (let ((sight (get-sight~ lookat))
            (up (get-up~ lookat))
            (right (get-right~ lookat)))
        (glMultMatrixv
          (vertex-x right) (vertex-x up) (vertex-x sight) 0.
          (vertex-y right) (vertex-y up) (vertex-y sight) 0.
          (vertex-z right) (vertex-z up) (vertex-z sight) 0.
          0. 0. 0. 1.)))
    (glColor4f red green blue alpha)
    (let ((x1 (- radius-x))
          (x2 radius-x)
          (y1 (- radius-y))
          (y2 radius-y)
          (z1 (- radius-z))
          (z2 radius-z))
      ;; top
      (glNormal3f 0.0 1.0 0.0)
      (glBegin GL_QUADS)
      (glVertex3f x2 y2 z1)
      (glVertex3f x1 y2 z1)
      (glVertex3f x1 y2 z2)
      (glVertex3f x2 y2 z2)
      (glEnd)
      ;; bottom
      (glNormal3f 0.0 -1.0 0.0)
      (glBegin GL_QUADS)
      (glVertex3f x2 y1 z2)
      (glVertex3f x1 y1 z2)
      (glVertex3f x1 y1 z1)
      (glVertex3f x2 y1 z1)
      (glEnd)
      ;; front
      (glNormal3f 0.0 0.0 1.0)
      (glBegin GL_QUADS)
      (glVertex3f x1 y1 z2)
      (glVertex3f x2 y1 z2)
      (glVertex3f x2 y2 z2)
      (glVertex3f x1 y2 z2)
      (glEnd)
      ;; back
      (glNormal3f 0.0 0.0 -1.0)
      (glBegin GL_QUADS)
      (glVertex3f x2 y1 z1)
      (glVertex3f x1 y1 z1)
      (glVertex3f x1 y2 z1)
      (glVertex3f x2 y2 z1)
      (glEnd)
      ;; left
      (glNormal3f -1.0 0.0 0.0)
      (glBegin GL_QUADS)
      (glVertex3f x1 y2 z2)
      (glVertex3f x1 y2 z1)
      (glVertex3f x1 y1 z1)
      (glVertex3f x1 y1 z2)
      (glEnd)
      ;; right
      (glNormal3f 1.0 0.0 0.0)
      (glBegin GL_QUADS)
      (glVertex3f x2 y2 z1)
      (glVertex3f x2 y2 z2)
      (glVertex3f x2 y1 z2)
      (glVertex3f x2 y1 z1)
      (glEnd))
    (glPopMatrix))))
