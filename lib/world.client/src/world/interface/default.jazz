;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; World Default Interface
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2013
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.interface.default jazz


(import (jazz.io)
        (jazz.jml)
        (jazz.graphic)
        (jazz.graphic.opengl.glew)
        (jazz.library)
        (jazz.literals)
        (jazz.platform)
        (jazz.platform.cairo)
        (jazz.system)
        (jazz.ui)
        (jazz.ui.view)
        (world)
        (world.autoload)
        (world.interface)
        (world.interface.actions)
        (world.interface.pane)
        (world.syntax (phase syntax)))


;;;
;;;; Main
;;;


(class Main-Bar extends World-Actionbar
  
  
  (form
    (<install>
      @wait
      (<World-Action-Button> resource: {Image-Resource "WebServer"} action-handler: {Action world-world world-open})
      (<World-Action-Button> resource: {Image-Resource "New"} action-handler: {Action world-zone zone-new})
      (<World-Action-Button> resource: {Image-Resource "Open"} action-handler: {Action world-zone zone-open})
      (<World-Action-Button> resource: {Image-Resource "Save"} action-handler: {Action world-zone zone-save})
      (<World-Action-Button> resource: {Image-Resource "ServerRunning"} action-handler: {Action world-zone save-player})
      (<World-Action-Button> resource: {Image-Resource "Refresh"} action-handler: {Action world-zone zone-revert})
      (<World-Action-Button> resource: {Image-Resource "Grab"} action-handler: {Action world-interface main-menu}))))


;;;
;;;; Spell/Game
;;;


(class Spell/Game-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "Threads"} action-handler: {Action world-spell sprint})
      (<World-Action-Button> resource: {Image-Resource "Link"} action-handler: {Action world-game mind-control})
      (<World-Action-Button> resource: {Image-Resource "Close"} action-handler: {Action world-game toggle-aim})
      (<World-Action-Button> resource: {Image-Resource "Constructor"} action-handler: {Action world-game change-ground-mount})
      (<World-Action-Button> resource: {Image-Resource "OfferDestination"} action-handler: {Action world-game toggle-fly})
      (<World-Action-Button> resource: {Image-Resource "MsgUser"} action-handler: {Action world-game toggle-player}))))


;;;
;;;; Edition
;;;


(class Edition-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "Model"} action-handler: {Action world-edition import-model})
      (<World-Action-Button> resource: {Image-Resource "Export"} action-handler: {Action world-edition add-model})
      (<World-Action-Button> resource: {Image-Resource "Threads"} action-handler: {Action world-edition change-target-animation})
      (<World-Action-Button> resource: {Image-Resource "Script"} action-handler: {Action world-edition run-script})
      (<World-Action-Button> resource: {Image-Resource "Export"} action-handler: {Action world-edition run-last-script})
      (<World-Action-Button> resource: {Image-Resource "Tile"} action-handler: {Action world-edition toggle-grid})
      (<World-Action-Button> resource: {Image-Resource "JemUpdateCategories"} action-handler: {Action world-edition change-element-class})
      (<World-Action-Button> resource: {Image-Resource "Link"} action-handler: {Action world-edition change-tile-program})
      (<World-Action-Button> resource: {Image-Resource "BackgroundColor"} action-handler: {Action world-edition change-tile-texture})
      (<World-Action-Button> resource: {Image-Resource "Component"} action-handler: {Action world-edition change-editor-mode})
      (<World-Action-Button> resource: {Image-Resource "WorkspaceGroupware"} action-handler: {Action world-edition change-target-mode})
      (<World-Action-Button> resource: {Image-Resource "Grab"} action-handler: {Action world-edition change-skybox}))))


;;;
;;;; Interface/Graphics/Sound
;;;


(class Interface/Graphics/Sound-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "WorkspaceGroupware"} action-handler: {Action world-interface toggle-interface})
      (<World-Action-Button> resource: {Image-Resource "Archive"} action-handler: {Action world-interface toggle-counters})
      (<World-Action-Button> resource: {Image-Resource "Refresh"} action-handler: {Action world-interface reset-counters})
      (<World-Action-Button> resource: {Image-Resource "Spy"} action-handler: {Action world-graphics toggle-lighting})
      (<World-Action-Button> resource: {Image-Resource "Gray"} action-handler: {Action world-graphics toggle-gadgets})
      (<World-Action-Button> resource: {Image-Resource "FullScreen"} action-handler: {Action world-graphics toggle-normals})
      (<World-Action-Button> resource: {Image-Resource "Model"} action-handler: {Action world-graphics toggle-elements})
      (<World-Action-Button> resource: {Image-Resource "Build"} action-handler: {Action world-graphics toggle-post-processing})
      (<World-Action-Button> resource: {Image-Resource "MsgUser"} action-handler: {Action world-sound change-music}))))


;;;
;;;; Camera
;;;


(class Camera-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "Open"} action-handler: {Action world-camera toggle-3d})
      (<World-Action-Button> resource: {Image-Resource "DesignRelation"} action-handler: {Action world-camera toggle-camera-lock})
      (<World-Action-Button> resource: {Image-Resource "MsgUser"} action-handler: {Action world-camera toggle-first-person}))))


;;;
;;;; History
;;;


(class History-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "Pause"} action-handler: {Action world-history toggle-paused})
      (<World-Action-Button> resource: {Image-Resource "Backward"} action-handler: {Action world-history backward-history})
      (<World-Action-Button> resource: {Image-Resource "Forward"} action-handler: {Action world-history forward-history})
      (<World-Action-Button> resource: {Image-Resource "StepOver"} action-handler: {Action world-history step-world})
      (<World-Action-Button> resource: {Image-Resource "ToggleBreak"} action-handler: {Action world-history toggle-history})
      (<World-Action-Button> resource: {Image-Resource "ClearResults"} action-handler: {Action world-history reset-history})
      (<World-Action-Button> resource: {Image-Resource "Constructor"} action-handler: {Action world-history toggle-evaluate-future}))))


;;;
;;;; Window
;;;


(class Window-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "Window"} action-handler: {Action world-window toggle-windowed-mode})
      (<World-Action-Button> resource: {Image-Resource "Script"} action-handler: {Action world-window live-gaia/world})
      (<World-Action-Button> resource: {Image-Resource "Sorcerer"} action-handler: {Action world-window design-gaia/world})
      (<World-Action-Button> resource: {Image-Resource "Cancel"} action-handler: {Action world-window restore-gaia/world}))))


;;;
;;;; Debug
;;;


(class Debug-Bar extends World-Actionbar
  
  
  (form
    (<install>
      (<World-Action-Button> resource: {Image-Resource "Library"} action-handler: {Action world-debug toggle-info})
      (<World-Action-Button> resource: {Image-Resource "Configure"} action-handler: {Action world-debug toggle-axes})
      (<World-Action-Button> resource: {Image-Resource "Spy"} action-handler: {Action world-debug toggle-eye})
      (<World-Action-Button> resource: {Image-Resource "Process"} action-handler: {Action world-debug toggle-debug-sectors})
      (<World-Action-Button> resource: {Image-Resource "ProcessDead"} action-handler: {Action world-debug toggle-debug-areas})
      (<World-Action-Button> resource: {Image-Resource "Current"} action-handler: {Action world-debug toggle-draw-atlas})
      (<World-Action-Button> resource: {Image-Resource "MsgUser"} action-handler: {Action world-debug toggle-draw-me})
      (<World-Action-Button> resource: {Image-Resource "Present"} action-handler: {Action world-debug change-missile-behavior})
      (<World-Action-Button> resource: {Image-Resource "Refresh"} action-handler: {Action world-debug reset-all-marks})
      (<World-Action-Button> resource: {Image-Resource "Cancel"} action-handler: {Action world-debug clear-terminal})
      (<World-Action-Button> resource: {Image-Resource "Link"} action-handler: {Action world-debug garbage-collect})
      (<World-Action-Button> resource: {Image-Resource "Watch"} action-handler: {Action world-debug explore-interface}))))


;;;
;;;; Install
;;;


(definition public (setup-default-interface)
  (let ((world (current-world)))
    (let ((interface (get-interface~ world)))
      (define (install-bar class orientation location)
        (let ((bar (new class parent: interface visible?: #f)))
          (let ((count (length (get-children~ bar))))
            (install-tooltips bar)
            (set-layout-justification~ bar orientation)
            (set-size~ bar (case orientation
                             ((vertical) (new Dimension 22 (+ (* count 22) (* (- count 1) 2))))
                             ((horizontal) (new Dimension (+ (* count 22) (* (- count 1) 2)) 22))))
            (set-location~ bar location)
            (set-visible?~ bar #t))))
      
      (define (install-tooltips bar)
        (for-each (lambda (button)
                    (let ((title (get-title~ (require-action-item (get-action-handler~ button)))))
                      (set-tooltip-text~ button title)))
                  (get-children~ bar)))
      
      (for-each (lambda (child)
                  (when (is? child World-Actionbar)
                    (close~ child)))
                (get-children~ interface))
      (let ((left? #t))
        (install-bar Main-Bar 'horizontal '(center -10))
        (install-bar Spell/Game-Bar 'horizontal '(center -36))
        (install-bar Window-Bar 'horizontal '(-10 -10))
        (install-bar Camera-Bar 'horizontal '(-10 -36))
        (install-bar Debug-Bar 'horizontal (list (if left? 10 -168) -10))
        (install-bar History-Bar 'horizontal (list (if left? 10 -168) -36))
        (install-bar Edition-Bar 'vertical '(-36 center))
        (install-bar Interface/Graphics/Sound-Bar 'vertical '(-10 center)))
      (layout-view~ interface)))))
