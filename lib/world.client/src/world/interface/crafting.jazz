;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Crafting
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2016
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.interface.crafting jazz


(import (jazz.action)
        (jazz.component)
        (jazz.graphic)
        (jazz.handler)
        (jazz.jml)
        (jazz.text)
        (jazz.ui)
        (jazz.view)
        (world)
        (world.interface.dialogs)
        (world.interface.inventory)
        (world.interface.panel)
        (world.interface.text)
        (world.syntax (phase syntax)))



;;;
;;;; Crafting window
;;;



(class Crafting-Pane extends World-Panel ;; shadow palette raised edge solid
  
  (form
    (<install>               
      (<Border-View>              size: {Dimension 550 300} border-color: {Color Dark} border-type: solid style: entry
        (<Layout-View>            layout-type: border
          (<Crafting-Inventory>   name: inventory position: {Point 0 0} size: {Dimension 550 300}
            (<Inventory-Slot>     name: slot1 position: {Point 100 10} rank: 63))))))
  
  
  (method (get-slot-table)
    (get-slot-table~ (locate 'inventory)))
  
  
  (method override (on-return-press evt)
    (let ((ok (locate 'ok)))
      (when (get-enabled?~ ok)
        (process-action~ ok ok)))))



(class Recipe-Slot extends View
  
  
  (property recipe initialize #f getter generate)
  
  
  (form
    (<install>                          size: {Dimension 48 48} draggable?: #t tooltip?: #t))
  
  
  (method override (draw surface context)
    (let ((bounds (get-bounds)))
      (frame-partial-rect~ surface bounds '(left top) {Color Entry-Border})
      (frame-partial-rect~ surface bounds '(right bottom) {Color Entry-Border alpha: .6}))))



(class Crafting-Inventory extends Inventory-Pane
  
  (method override (setup-inventory)
    (set! slot-table (make-table))
    (loop (for x from 0 below (length children))
          (table-set! slot-table x (list-ref children x)))))



(class Crafting-Recipe extends Object
  
  
  (slot inputs  <list> initialize '() getter generate)
  (slot outputs <list> initialize '() getter generate)
  
  
  (method override (initialize inputs outputs)
    (set! inputs~self inputs)
    (set! outputs~self outputs)))



(class Crafting-Library extends Object
  
  
  (slot recipes <table> initialize (make-table) getter generate)
  
  )


(definition crafting-library
  (new Crafting-Library))


(definition protected (register-crafting-recipe input <list> output <list>)
  ))
