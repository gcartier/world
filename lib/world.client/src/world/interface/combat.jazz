;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Combat Pane
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2016
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.interface.combat jazz


(import (jazz.graphic)
        (jazz.jml)
        (world)
        (world.interface.pane)
        (world.interface.tooltip)
        (world.player)
        (world.syntax (phase syntax)))


(class Combat-Pane extends World-Pane
  
  
  (form
    (<install> tooltip?: #t))
  
  
  ;;;
  ;;;; Draw
  ;;;
  
  
  (method override (draw surface context)
    (let ((me (current-me)))
      (let ((life (get-life~ me)))
        (let ((rect (new Rect 0 0 (+ 0 (fxround (/ (* life 160.) 100.))) 15)))
          (fill-rect~ surface rect {Color Blue})
          (frame-rect~ surface (new Rect 0 0 160 16) {Color Black})))))
  
  
  ;;;
  ;;;; Tooltip
  ;;;
  
  
  (method override (get-tooltip-context pos)
    (define (present-text)
      (let ((me (current-me)))
        `(<span>
           (<paragraph>
             (<text> color: World-Green ,(format "{a}/100" (fxround (get-life~ me))))))))
    
    (let ((text (present-text))
          (bounds (get-tooltip-bounds pos)))
      (tooltip-context self text bounds)))))
