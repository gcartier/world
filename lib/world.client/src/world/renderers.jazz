;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; Renderers
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2013
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.renderers jazz


(import (jazz.geometry)
        (jazz.graphic)
        (jazz.graphic.opengl.glew)
        (jazz.library)
        (world)
        (world.autoload)
        (world.geometry)
        (world.support)
        (world.syntax (phase syntax))
        (world.task))


(proclaim (warn optimizations))


(definition renderers
  (make-table test: eq?))

(definition public (get-renderers)
  renderers)

(definition public (register-renderer name renderer)
  (table-set! renderers name renderer)
  renderer)

(definition public (find-renderer name)
  (table-ref renderers name #f))

(definition public (require-renderer name)
  (or (find-renderer name)
      (error "Unknown renderer: {a}" name)))


(definition public (reset-renderes)
  (iterate-table renderers
    (lambda (name renderer <Mesh-Renderer>)
      (reset~ renderer))))


(definition protected (report-renderers)
  (iterate-table renderers
    (lambda (name renderer <Mesh-Renderer>)
      (debug name
             (get-size~ (get-meshes~ renderer))
             (get-size~ (get-entities~ renderer))))))


;;;
;;;; Renderers
;;;


(definition public opaque-renderer <Mesh-Renderer>
  #f)

(definition protected (set-opaque-renderer renderer)
  (set! opaque-renderer renderer))

(definition public transparent-renderer <Mesh-Renderer>
  #f)

(definition protected (set-transparent-renderer renderer)
  (set! transparent-renderer renderer))

(definition public culled-transparent-renderer <Mesh-Renderer>
  #f)

(definition protected (set-culled-transparent-renderer renderer)
  (set! culled-transparent-renderer renderer))

(definition public coverage-renderer <Mesh-Renderer>
  #f)

(definition protected (set-coverage-renderer renderer)
  (set! coverage-renderer renderer))

(definition public occlusion-renderer <Mesh-Renderer>
  #f)

(definition protected (set-occlusion-renderer renderer)
  (set! occlusion-renderer renderer))

(definition public wireframe-renderer <Mesh-Renderer>
  #f)

(definition protected (set-wireframe-renderer renderer)
  (set! wireframe-renderer renderer))

(definition public squareframe-renderer <Mesh-Renderer>
  #f)

(definition protected (set-squareframe-renderer renderer)
  (set! squareframe-renderer renderer))

(definition public radial-blur-renderer <Mesh-Renderer>
  #f)

(definition protected (set-radial-blur-renderer renderer)
  (set! radial-blur-renderer renderer))

(definition public motion-blur-renderer <Mesh-Renderer>
  #f)

(definition protected (set-motion-blur-renderer renderer)
  (set! motion-blur-renderer renderer))

(definition public water-renderer <Mesh-Renderer>
  #f)

(definition protected (set-water-renderer renderer)
  (set! water-renderer renderer))

(definition public wet-renderer <Mesh-Renderer>
  #f)

(definition protected (set-wet-renderer renderer)
  (set! wet-renderer renderer))

(definition public julia-renderer <Mesh-Renderer>
  #f)

(definition protected (set-julia-renderer renderer)
  (set! julia-renderer renderer))

(definition public sierpinski-renderer <Mesh-Renderer>
  #f)

(definition protected (set-sierpinski-renderer renderer)
  (set! sierpinski-renderer renderer))

(definition public multitexture-renderer <Mesh-Renderer>
  #f)

(definition protected (set-multitexture-renderer renderer)
  (set! multitexture-renderer renderer))

(definition public kaleidoscope-renderer <Mesh-Renderer>
  #f)

(definition protected (set-kaleidoscope-renderer renderer)
  (set! kaleidoscope-renderer renderer))

(definition public tunnel-renderer <Mesh-Renderer>
  #f)

(definition protected (set-tunnel-renderer renderer)
  (set! tunnel-renderer renderer))

(definition public square-tunnel-renderer <Mesh-Renderer>
  #f)

(definition protected (set-square-tunnel-renderer renderer)
  (set! square-tunnel-renderer renderer))

(definition public fly-renderer <Mesh-Renderer>
  #f)

(definition protected (set-fly-renderer renderer)
  (set! fly-renderer renderer))

(definition public color-renderer <Mesh-Renderer>
  #f)

(definition protected (set-color-renderer renderer)
  (set! color-renderer renderer))

(definition public character-renderer <Mesh-Renderer>
  #f)

(definition protected (set-character-renderer renderer)
  (set! character-renderer renderer))

(definition public character2-renderer <Mesh-Renderer>
  #f)

(definition protected (set-character2-renderer renderer)
  (set! character2-renderer renderer))

(definition public drawable-renderer <Mesh-Renderer>
  #f)

(definition protected (set-drawable-renderer renderer)
  (set! drawable-renderer renderer)))
