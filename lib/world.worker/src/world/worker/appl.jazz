;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; World Worker Application
;;;


(module world.worker.appl jazz


@bantoo
(require (jiri.splash))

(import (jazz.application)
        (jazz.component)
        (jazz.event)
        (jazz.view)
        (jazz.window)
        (jiri.appl)
        (jiri.work)
        (world.worker))


;;;
;;;; Application
;;;


(class Worker-Application extends Jiri-Application

  
  (method override (process-name self)
    "World")
  
  
  (method override (new-toplevel self)
    (new Worker-Toplevel))
  
  
  (method override (show-toplevel self)
    )
  
  
  (method override (conclude-process self)
    (nextmethod self)
    ;; for some strange reason initialy showing the
    ;; toplevel in an send-event crashes on Windows
    (cond-expand
      (windows
       (set-visible? (current-toplevel) #t)
       (set-visible? (current-toplevel) #f))
      (else))
    (if (command-argument "master")
        (ready-worker
          (lambda (message)
            (send-event
              (lambda ()
                (let ((toplevel (get-toplevel self)))
                  (unless (get-visible? toplevel)
                    (center-window toplevel)
                    (set-visible? toplevel #t)))
                (set-title stage-view message))))
          (lambda ()
            (send-event
              (lambda ()
                (set-visible? (get-toplevel self) #f)
                (set-title stage-view "Done")))))
      (message-box "It is incorrect to launch this application")
      (exit 1))))


;;;
;;;; Toplevel
;;;


(class Worker-Toplevel extends Jiri-Toplevel
  
  
  (method override (effective-title self)
    "World")))
