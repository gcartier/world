;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; World Worker Application
;;;


(module world.worker.appl jazz


(import (jazz.event)
        (jazz.ui.view)
        (jiri.appl)
        (jiri.work)
        (world.worker))


;;;
;;;; Application
;;;


(class Worker-Application extends Jiri-Application

  
  (method override (process-name)
    "World")
  
  
  (method override (new-toplevel)
    (new Worker-Toplevel))
  
  
  (method override (show-toplevel)
    )
  
  
  (method override (conclude-process)
    (nextmethod)
    ;; for some strange reason initialy showing the
    ;; toplevel in an execute-event crashes on Windows
    (cond-expand
      (windows
       (set-visible?~ (get-toplevel) #t)
       (set-visible?~ (get-toplevel) #f))
      (else))
    (let ((port (command-argument "port")))
      (if port
          (start-worker-thread port
            (lambda (message)
              (execute-event
                (lambda ()
                  (let ((toplevel (get-toplevel)))
                    (unless (get-visible?~ toplevel)
                      (center-window~ toplevel)
                      (set-visible?~ toplevel #t)))
                  (set-title~ stage-view message))))
            (lambda ()
              (execute-event
                (lambda ()
                  (set-visible?~ (get-toplevel) #f)
                  (set-title~ stage-view "Done")))))
        (message-box "It is incorrect to launch this application")
        (exit 1)))))


;;;
;;;; Toplevel
;;;


(class Worker-Toplevel extends Jiri-Toplevel
  
  
  (method override (effective-title)
    "World")))
