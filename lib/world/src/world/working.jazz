;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Working
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2016
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.working jazz


(definition protected working-debug?
  #f)

(definition protected (set-working-debug? debug?)
  (set! working-debug? debug?))


(definition protected (with-working thunk)
  (if working-debug?
      (thunk)
    (with-exception-catcher
      (lambda (exc)
        (list 'error (exception-reason exc) #f))
      thunk)))


(definition protected (with-evaluating thunk)
  (if working-debug?
      (thunk)
    (with-exception-catcher
      (lambda (exc)
        (list 'read (exception-reason exc) #f))
      (lambda ()
        (catch (Walk-Problems exc
                 (list 'walk (exception-reason exc) (exception-detail exc)))
          (thunk)))))))
