;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Scripting
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2015
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.scripting jazz


(import (world)
        (world.autoload)
        (world.syntax (phase syntax))
        (world.work))


(definition public current-instance
  (make-parameter #f))


(definition public (evaluate-script actor script)
  (let ((world (current-world)))
    (parameterize ((current-instance actor))
      (with-exception-catcher
        (lambda (exc)
          (debug exc))
        (lambda ()
          (worker-evaluate 'jazz script #f 0 0
            (lambda (reason detail)
              (display-walk-problems~ world detail))
            (lambda (reason)
              (display-message~ world (format "{a}" reason))))))))))
