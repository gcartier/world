;;;===============
;;;  WorldScheme
;;;===============
;;;
;;;; World Chunks
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 2012-2015
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):


(module world.chunk jazz


(proclaim (warn optimizations))


;;;
;;;; Chunk
;;;


(class World-Chunk extends Object
  
  
  (slot region                          getter generate)
  (slot sections <table+> initialize #f getter generate)
  
  
  (method override (initialize region)
    (set! region~self region))
  
  
  (method (add-section y section)
    (unless sections
      (set! sections (make-table test: eq?)))
    (table-set! sections y section)))


;;;
;;;; Data
;;;


(class World-Data extends Object
  
  
  (slot blocks      getter generate)
  (slot data        getter generate)
  (slot blocklight  getter generate)
  (slot skylight    getter generate)
  (slot powerlevels getter explicit)
  
  
  (method override (initialize blocks data blocklight skylight)
    (set! blocks~self blocks)
    (set! data~self data)
    (set! blocklight~self blocklight)
    (set! skylight~self skylight)
    (set! powerlevels~self #f))
  
  
  (method public (get-powerlevels)
    (or powerlevels
        (let ((vec (make-u8vector 4096 255)))
          (set! powerlevels vec)
          vec)))))
